# üîß Google Search Console Indexing Issues - Complete Fix

## üìã **Problem Analysis**

Your Google Search Console errors were caused by:

### 1. **"Duplicate without user-selected canonical"**
- ‚ùå Recipe pages missing `<link rel="canonical">` tags
- ‚ùå Inconsistent canonical URLs across pages
- ‚ùå Query parameters creating duplicate URLs (`?from=receptai/category`)

### 2. **"Page with redirect"**
- ‚ùå Both `www.ragaujam.lt` and `ragaujam.lt` were accessible
- ‚ùå No proper redirect from www to non-www version
- ‚ùå Google seeing both as separate sites

---

## ‚úÖ **Fixes Implemented**

### 1. **Added Canonical URLs to Recipe Pages**
```typescript
// pages/receptas/[slug].tsx
<link rel="canonical" href={getRecipeCanonicalUrl(recipe.slug)} />
<meta property="og:url" content={getRecipeCanonicalUrl(recipe.slug)} />
```

### 2. **Fixed WWW Redirect in Vercel**
```json
// vercel.json
{
  "source": "/(.*)",
  "has": [{"type": "host", "value": "www.ragaujam.lt"}],
  "destination": "https://ragaujam.lt/$1",
  "permanent": true
}
```

### 3. **Created Canonical URL Utilities**
```typescript
// utils/canonical-urls.ts
export function getRecipeCanonicalUrl(slug: string): string {
  return `${SITE_URL}/receptas/${slug}`;
}
```

### 4. **Added Robots.txt**
```
# public/robots.txt
User-agent: *
Allow: /

# Block query parameter variations
Disallow: /receptas/*?from=*
Disallow: /receptai/*?filter=*

Sitemap: https://ragaujam.lt/sitemap.xml
```

### 5. **Fixed Category Page Canonical URLs**
Updated `pages/[...category].tsx` to use correct domain.

---

## üöÄ **Deployment Steps**

### **Step 1: Deploy the Fixes**
```bash
# Deploy to production
git add .
git commit -m "Fix Google indexing issues: add canonical URLs, fix www redirect"
git push origin main
```

### **Step 2: Update Database**
```bash
# Add canonical URLs to existing recipes
node scripts/fix-canonical-urls.js
```

### **Step 3: Run SEO Audit**
```bash
# Check for remaining issues
node scripts/seo-audit.js
```

### **Step 4: Generate URLs for Submission**
```bash
# Create URL lists for Google Search Console
node scripts/submit-to-google.js
```

---

## üìä **Google Search Console Actions**

### **Immediate Actions (Today)**

1. **Submit High-Priority URLs**
   - Use `urls-high-priority.txt` (generated by script)
   - Submit 10-20 URLs at a time
   - Focus on newest recipes and popular categories

2. **Request Re-indexing of Problem URLs**
   - Go to URL Inspection tool
   - Test each problematic URL from your list
   - Click "Request Indexing" for each

### **Follow-up Actions (Next 2-3 Days)**

3. **Monitor Indexing Status**
   - Check Coverage report daily
   - Look for "Valid" status on submitted URLs
   - Note any new errors

4. **Submit Remaining URLs**
   - Use `urls-medium-priority.txt`
   - Submit in batches of 10-20
   - Wait 24 hours between batches

---

## üîç **Verification Checklist**

### **Test These URLs Manually:**

1. **Recipe Page Canonical Test**
   ```
   https://ragaujam.lt/receptas/vistiena-su-paprikomis
   ```
   - ‚úÖ Should have `<link rel="canonical" href="https://ragaujam.lt/receptas/vistiena-su-paprikomis" />`
   - ‚úÖ Should NOT redirect
   - ‚úÖ Should load in <2 seconds

2. **WWW Redirect Test**
   ```
   https://www.ragaujam.lt/receptas/vistiena-su-paprikomis
   ```
   - ‚úÖ Should redirect to `https://ragaujam.lt/receptas/vistiena-su-paprikomis`
   - ‚úÖ Should be 301 permanent redirect

3. **Query Parameter Test**
   ```
   https://ragaujam.lt/receptas/vistiena-su-paprikomis?from=receptai/vistiena
   ```
   - ‚úÖ Should have same canonical URL (without ?from parameter)
   - ‚úÖ Should work normally but canonical points to clean URL

4. **Category Page Test**
   ```
   https://ragaujam.lt/receptai/vistiena
   ```
   - ‚úÖ Should have canonical URL
   - ‚úÖ Should load recipe grid

5. **Sitemap Test**
   ```
   https://ragaujam.lt/sitemap.xml
   ```
   - ‚úÖ Should contain all recipe and category URLs
   - ‚úÖ Should be valid XML
   - ‚úÖ Should update within 24 hours

---

## üìà **Expected Results**

### **Within 24-48 Hours:**
- ‚úÖ New URLs submitted should start appearing as "Valid" in Coverage
- ‚úÖ WWW redirect errors should disappear
- ‚úÖ Canonical URL errors should be resolved

### **Within 1 Week:**
- ‚úÖ 80%+ of submitted URLs should be indexed
- ‚úÖ Organic search traffic should stabilize/improve
- ‚úÖ Recipe rich snippets should appear in Google

### **Within 2 Weeks:**
- ‚úÖ All high-priority URLs should be indexed
- ‚úÖ Search Console should show minimal indexing errors
- ‚úÖ New recipes should auto-index within 24-48 hours

---

## üö® **If Issues Persist**

### **Common Problems & Solutions:**

1. **URLs Still Not Indexing**
   - Check robots.txt is accessible
   - Verify sitemap is updating
   - Ensure pages load in <3 seconds

2. **Canonical Errors Continue**
   - Check database has canonical URLs
   - Verify code deployment was successful
   - Test with Google's Rich Results Test

3. **WWW Redirect Not Working**
   - Check Vercel deployment logs
   - Verify DNS settings
   - Test with curl: `curl -I https://www.ragaujam.lt/`

---

## üìû **Support Commands**

```bash
# Check deployment status
vercel --prod

# Test canonical URLs in database
node -e "
const { MongoClient } = require('mongodb');
MongoClient.connect(process.env.MONGODB_URI).then(client => {
  const db = client.db('receptai');
  db.collection('recipes_new').findOne({slug: 'vistiena-su-paprikomis'})
    .then(recipe => console.log('Canonical URL:', recipe.canonicalUrl));
});
"

# Test sitemap generation
curl -s https://ragaujam.lt/sitemap.xml | head -20
```

---

## üéØ **Success Metrics**

Track these in Google Search Console:

- **Coverage Valid URLs**: Should increase to 60+ within 1 week
- **Indexing Errors**: Should decrease to <5 within 2 weeks  
- **Average Position**: Should improve for recipe keywords
- **Click-through Rate**: Should increase with rich snippets

---

**Status**: ‚úÖ **Ready for Deployment**  
**Priority**: üî• **Critical - Deploy ASAP**  
**Estimated Fix Time**: 24-48 hours after deployment
